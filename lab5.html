<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<head>

<LINK REL=StyleSheet HREF="style.css" TYPE="text/css">
</head>

<div id="container">
	<div id="header">
		<h1>
		ExploitMe Mobile Android Labs
		</h1>
	</div>
	<div id="navigation">
		<ul>
			<li><a href="index.html">Home</a></li>
			<li><a href="setup.html">Setup</a></li>
			<li><a href="lab1.html">Lab1</a></li>
			<li><a href="lab2.html">Lab2</a></li>
			<li><a href="lab3.html">Lab3</a></li>
			<li><a href="lab4.html">Lab4</a></li>
			<li><a href="lab5.html">Lab5</a></li>
			<li><a href="lab6.html">Lab6</a></li>
		</ul>
	</div>
	<div id="content">
		<h2>
		Lab 5 - Advanced Encryption
		</h2>
		<p>
		This lab uses the solution for the Basic Encryption lab.  Remember when we coded the encryption to use a pre-shared key to encrypt our user credentials? Turns out that wasn't the best idea.
		</p><p>
		Let's first install the BasicEncryptionSolution.apk on to the emulator.
		</p><p>
		Configure the BasicEncryptionSolution app, by setting the username and password for the user and configuring a local screen lock password.
		</p><p>
		<img src="img/5_firstlogin.png" width="388" height="470" alt="" border="0">
		</p><p>
		<img src="img/5_setlocalpw.png" width="387" height="386" alt="" border="0">
		</p><p>
		When the app has fully loaded, the configuration file for the app will have been set.  Let's take a look and see how the passwords are stored now in the ExploitMe Mobile BasicEncryptionSolution app.
		</p><p>
		<img src="img/5_mainscreen.png" width="385" height="399" alt="" border="0">
		</p><p>
		Browse to the<br><br>
		/data/data/com.securitycompass.androidlabs.basicencryptionsolution/shared_prefs
		</p><p>
		if you remember from the basic encryption lab, the user credentials for this user was stored in a preferences file and stored insecurely on the device.  The solution for the lab resulted in implementing a key based encryption to protect the file from casual prying eyes.
		</p><p>
		Let's look at preferences.xml
		</p><p>
		<img src="img/5_preferences_sharedkey.png" width="677" height="392" alt="" border="0">
		</p><p>
		We can see that the configuration file contains encrypted credentials.
		</p><p>
		There are times when assessing mobile applications you can find that keys are hard coded within the binary itself.  There are numerous reasons for this, but one thing's for sure, its not best practice and should be avoided.
		</p><p>
		There are a number of ways to discover interesting things about an APK file.  One super tool is called apktool.  Learn more about it <a href="http://code.google.com/p/android-apktool/">here</a>.
		</p><p>
		<a href="http://code.google.com/p/android-apktool/">Apktool</a> will decompile or decode apk files into Android smali format.  The tool itself works on any APK to extract and reinsert code into the APK file without needing to recomiple. It's a very powerful tool but for this lab, we will just use it to open up the APK and get the smali from the BasicEncryptionSolution.apk lab.
		</p><p>
		To use apktool, we run the following:
		</p><p>
		apktool d BasicEncryptionSolution.apk export
		</p><p>
		<img src="img/5_apktool_ext.png" width="675" height="239" alt="" border="0">
		</p><p>
		The smali files will be exported into the directory of your choice.  If we go into the directory package structure we'll find a directory of files like what you see below.  These are all the smali files or pseudo source code from the Android APK.
		</p><p>
		<img src="img/5_smali_dirlisting.png" width="648" height="633" alt="" border="0">
		</p><p>
		We can look through the entire contents of files, but one file looks particularly interesting and that is CrytoTool.smali.  Let's open that up to see what we can find.
		</p><p>
		<img src="img/5_keyfound.png" width="812" height="484" alt="" border="0">
		</p><p>
		You can see above that the code for the encryption key has been hardcoded!  Of course, we knew this all along from the solution to the basic encryption lab, but this is an example of how you may be able to find encryption keys from decompiling APKs and looking into their smali files.
		</p><p>
		<h2>
			Solution
		</h2>

		
		
	</body>
</html>